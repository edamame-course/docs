<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>EDAMAME : QIIME Tutorial 3</title>
        <meta name="description" content="course materials & tutorials">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/syntax.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <h4><a class=brand href="http://edamame-course.org">EDAMAME</a>
    <small>course materials & tutorials</small>
</h4>

                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span3>
                        
<ul class="nav nav-list">
    <li class=nav-header>HOME</li>
    <li><a href="index.html">EDAMAME course materials</a></li>
    <li class=divider></li>
    <li class=nav-header>Before We Begin</li>
    <li><a href="https://edamame-course.github.io/docs/general_set_up_guidelines.html">Getting Set Up For The Course</a></li>
    <li><a href="https://edamame-course.github.io/docs/intro_to_ec2_instance.html">All Users: Setting up an EC2 instance</a></li>
    <li><a href="https://edamame-course.github.io/docs/mobaxterm.html">Windows Users: Connecting to your AWS EC2 instance</a></li>
    <li><a href="https://edamame-course.github.io/docs/mac_os_linux_connect_to_ec2.html">Mac and Linux Users: Connecting to your AWS EC2 instance</a></li>
    <li><a href="https://edamame-course.github.io/docs/extra/macqiime_installation.html">Mac Users: Installing MacQIIME</a></li>
    <li><a href="https://edamame-course.github.io/docs/QIIME_VB_for_Windows.html">Windows Users: Installing a Virtual Box to run QIIME on your own Windows computer</a></li>
    <li class=divider></li>
    <li class=nav-header>Wednesday, August 13th</li>
    <li><a href="https://edamame-course.github.io/docs/august_13.html">Wednesday, August 13th Overview</a></li>
    <li><a href="https://edamame-course.github.io/docs/the_shell.html">An Introduction To Using The Shell</a></li>
    <li><a href="https://edamame-course.github.io/docs/intro_qiime_tutorial.html">Introduction to Data Analysis with QIIME</a></li>
    <li class=divider></li>
    <li class=nav-header>Thursday, August 14th</li>
    <li><a href="https://edamame-course.github.io/docs/august_14.html">Thursday, August 14th Overview</a></li>
    <li><a href="https://edamame-course.github.io/docs/extra/Presentations/2014-08-14-AM_Ashley_Lecture2.pdf?raw=true">Alpha Diversity Lecture</a></li>
    <li><a href="https://edamame-course.github.io/docs/qiime_2_tutorial.html">QIIME Tutorial Part Two</a></li>
    <li><a href="https://edamame-course.github.io/docs/extra/Presentations/2014-08-14-PM_Ashley_Lecture3.pdf?raw=true">Beta Diversity Lecture</a></li>
    <li><a href="https://edamame-course.github.io/docs/qiime_3.html">QIIME Tutorial Part Three</a></li>
    <li><a href="https://edamame-course.github.io/docs/extra/Presentations/2014-edamame-assembly_TBrown.pdf?raw=true">Titus Brown's Intro to Metagenomics Lecture</a></li>
    <li class=divider></li>
    <li class=nav-header>Friday, August 15th</li>
    <li><a href="https://edamame-course.github.io/docs/august_15.html">Friday, August 15th Overview</a></li>
    <li><a href="https://edamame-course.github.io/docs/intro_to_ec2_instance.html">Introduction to using Amazon EC2</a></li>
    <li><a href="http://pschloss.github.io/2014_08_15-mothur/#1">Pat Schloss's Presentation</a></li>
    <li><a href="http://www.mothur.org/wiki/MiSeq_SOP">mothur to the max</a></li>
    <li class=divider></li>
    <li class=nav-header>Saturday, August 16th</li>
    <li><a href="https://edamame-course.github.io/docs/august_15.html">Saturday, August 16th Overview</a></li>
    <li><a href="">Introduction to Metagenomics</a></li>
    <li><a href="">Using BLAST at the command line</a></li>
    <li class=divider></li>
    <li class=nav-header>Sunday, August 17th</li>
    <li>Brunch with Jim Tiedje!</li>
    <li><a href="">Metagenome Assembly</a></li>
    <li class=divider></li>
    <li class=nav-header>Monday, August 18th</li>
    <li><a href="https://github.com/edamame-course/docs/august_18.html">Monday, August 18th Overview</a></li>
    <li><a href="https://github.com/edamame-course/docs/blob/gh-pages/extra/Presentations/2014-08-18-AM_Ashley_Lecture4.pdf?raw=true">Hypothesis testing, identifying gradients, and linking environmental and community data</a></li>
    <li><a href="https://github.com/edamame-course/docs/tree/gh-pages/extra/Jones_R_Tutorial_Files">Using R for community ecology analyses</a></li>
    <li><a href=""></a></li>
    <li class=divider></li>
    <li class=nav-header>Tuesday, August 19th</li>
    <li><a href="">Jim Cole - Guest Lecture</a></li>
    <li><a href="http://adina-howe.readthedocs.org/en/latest/">Adina Howe: Tutorial on working with NCBI and MG-RAST and their APIs</a></li>
    <li><a href="https://github.com/edamame-course/docs/blob/gh-pages/extra/Presentations/2014-08-19-Docherty_NEON.pdf?raw=true">Kathryn Docherty - Guest Lecture</a></li>
    <li><a href="https://edamame-course.github.io/docs/metagenome_assembly_and_annotation.html">Josh: Metagenome Assembly, Annotation, and Quality Assessment</a></li>
    <li><a href="https://edamame-course.github.io/docs/using_dropbox_on_your_ec2_machine.html">Josh: Installing Dropbox on any computer from the command line</a></li>
    <li><a href="https://github.com/edamame-course/docs/blob/gh-pages/_posts/2014-08-19_database_questions.md">Self Guided Tour of Databases</a></li>
    <li><a href="">Josh speaks about the wild and woolly world of other marker regions!</a></li>
    <li><a href="https://github.com/edamame-course/docs/blob/gh-pages/extra/Presentations/2014-08-19-Peralta.pdf?raw=true"></a>Guest lecture from Ariane Peralta on Human-impacted ecosystems</li>
    <li><a href="https://github.com/edamame-course/docs/blob/gh-pages/extra/Presentations/2014-08-20-metagenomic_visualization.pdf?raw=true">Tracy gives a tour of data visualization!</a></li>
    <li class=divider></li>
    <li class=nav-header>Wednesday, August 20th</li>
    <li><a href="https://edamame-course.github.io/docs/extra/Presentations/2014-08-20_Cluster_Computing_EDAMAME.pdf?raw=true">Guest Lecture from Dirk Colbry - Using a Computer Cluster</a></li>
    <li>Course Wrap-Up and Evaluation</li>
</ul>

                    </div>

                    <div id=content class=span9>
                        <div class=page-header>
    <h2>QIIME Tutorial 3
        
    </h2>
</div>

<h3 id="handouts-of-workflow-charts-are-available-for-the-qiime-workflow-discussed-in-these-tutorials:">Handouts of workflow charts are available for the QIIME workflow discussed in these tutorials:</h3>

<ul>
<li> <a href="https://github.com/edamame-course/docs/tree/gh-pages/extra/Handouts/QIIMEFlowChart_IlluminaPairedEnds_13aug2014.pdf?raw=true">Paired-End Illumina</a></li>
<li> <a href="https://github.com/edamame-course/docs/tree/gh-pages/extra/Handouts/QIIMEFlowChart_454_13aug2014.pdf?raw=true">454</a></li>
</ul>

<h2 id="4.1-make-resemblance-matrices-to-analyze-comparative-(beta)-diversity">4.1 Make resemblance matrices to analyze comparative (beta) diversity</h2>

<p>Make sure that you are in the QIIMETutorial directory.  Enter the QIIME environment.</p>

<p>If you need the Schloss_otu_table_even2212.biom file from Parts 1 and 2
of the tutorial you can download it here:</p>

<p><a href="https://edamame-course.github.io/docs/extra/Schloss_otu_table_even2212.biom?raw=true">Schloss_otu_table_even2212.biom</a></p>

<p>We will make three kinds of resemblance matrices (sample by sample comparisons) for assessing comparative diversity.</p>

<p>Use the <code>-s</code> option to see all of the different options for calculating beta diversity in QIIME.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">beta_diversity.py -s
</code></pre></div>
<p>To compare weighted/uweighted and phylogenetic/taxonomic metrics, we will ask QIIME to create four resemblance matrices of all of these different flavors.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">beta_diversity.py -i Schloss_otu_table_even2212.biom -m unweighted_unifrac,weighted_unifrac,binary_sorensen_dice,bray_curtis -o beta_div_even2212/ -t fasttree_cdhit/fasttree_cdhit.tre
</code></pre></div>
<p>There should be four new resemblance matrices in the new directory.  We&#39;re going to get all crazy and open these outside of the terminal. Use Excel to inspect them, and to compare their values.  This should be a square matrix, and the upper and lower triangles should be mirror-images.  The diagonal should be zero.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cd beta_div_even2212
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">Pop quiz:  Why is the diagonal zero?

##4.2 Using QIIME for visualization:  Ordination
QIIME scripts can easily make an ordination using principal components analysis (PCoA). We&#39;ll perform PCoA on all resemblance matrices, and compare them.  Documentation is [here](http://qiime.org/scripts/principal_coordinates.html).  As always, make sure you are in the QIIMETutorial directory to execute these analyses.
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">principal_coordinates.py -i beta_div_even2212/ -o beta_div_even2212_PCoA/
</code></pre></div>
<p>Notice that the <code>-i</code> command only specifies the directory, and not an individual filepath.  PCoA will be performed on all resemblances in that directory.  If we navigate into the new directory, we see there is one results file for each input resemblence matrix.</p>

<p><img src="https://github.com/edamame-course/docs/raw/gh-pages/img/QIIMETutorial3_IMG/IMG_17.jpg" alt="img17"></p>

<p>Inspect the one of these files using nano.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">nano pcoa_weighted_unifrac_Schloss_otu_table_even2212.txt
</code></pre></div>
<p><img src="https://github.com/edamame-course/docs/raw/gh-pages/img/QIIMETutorial3_IMG/IMG_18.jpg" alt="img18"></p>

<p>The first column has SampleIDs, and column names are PCoA axis scores for every dimension.  In PCoA, there are as many dimensions (axes) as there are samples. Remember that, typically, each axis explains less variability in the dataset than the previous axis.</p>

<p>These PCoA results files can be imported into other software for making ordinations outside of QIIME.</p>

<p>Navigate back into the QIIMETutorial directory.</p>

<p>We can make 2d plots of the output of <code>principal_coordinates.py</code>, and map the colors to the categories in the mapping file.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">make_2d_plots.py -i beta_div_even2212_PCoA/pcoa_weighted_unifrac_Schloss_otu_table_even2212.txt -m Schloss_Map.txt -o plotting_PCoA2d_even2212_wu/ --ellipsoid_opacity 0
</code></pre></div>
<p>Navigate into the new directory and open the html link.
<code>
cd plotting_PCoA2d_even2212_wu/
</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">open _2D_PCoA_plots.html
</code></pre></div>
<p><img src="https://github.com/edamame-course/docs/raw/gh-pages/img/QIIMETutorial3_IMG/IMG_19.jpg" alt="img19"></p>

<p>This is where  a comprehensive mapping file is priceless because any values or categories reported in the mapping file will be automatically color-coded for data exploration.  In the example above, there is an obvious difference in the community structure of the gut microbiota of the F3 mouse over time (using).</p>

<p>Take some time to explore these plots: toggle samples, note color categories, hover over points to examine sample IDs.  What hypotheses can be generated based on exploring these ordinations?</p>

<p><em>Exercise</em>
Make 2D plots for each PCoA analysis from each of the four difference resemblance results and compare them.  How are the results different, if at all?  Would you reach difference conclusions?</p>

<p><a href="http://ordination.okstate.edu/">The Ordination Web Page</a> is a great resource about all the different flavors of ordination.</p>

<h3 id="4.3-other-visualizations-in-qiime">4.3  Other visualizations in QIIME</h3>

<p>We can also make a quick heatmap in QIIME, which shows the number of sequences per sample relative to one another.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">make_otu_heatmap_html.py -i Schloss_otu_table_even2212.biom -o heatmap/
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">open Schloss_otu_table_even2212.html
</code></pre></div>
<p>Explore this visualization.  You can filter the minimum number of OTUs, filter by sample ID, or by OTU ID.  </p>

<p><em>Visualization considerations.</em> QIIME visualizations are currently being re-vamped by the developers.  In the next version, there will visualization scripts that are no longer supported, in favor of new tools.  Some of these tools include co-occurence networks enabled by Cytoscape (a MacQIIME add-on), and other visualizations by <a href="http://biocore.github.io/emperor/">emperor</a>.  There is always something new!</p>

<h3 id="4.4-exporting-the-qiime-created-biom-table-for-use-in-other-software-(r,-primer,-phinch,-etc)">4.4  Exporting the QIIME-created biom table for use in other software (R, Primer, Phinch, etc)</h3>

<p>This command changes frequently, as the biom format is a work in progress.  Use <code>biom convert -h</code> to find the most up-to-date arguments and options; the web page is not updated as frequently as the help file.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">biom convert -b -i Schloss_otu_table_even2212.biom -o Schloss_otu_table_even2212.txt --table-type otu  --header-key taxonomy --output-metadata-id &quot;ConsensusLineage&quot;
</code></pre></div>
<p>Here, we use the argument <code>-b</code> to specify that we are converting a biom-formatted table to a &quot;classic&quot; otu table.  We specify input and output files with <code>-i</code> and <code>-o</code>, as always.  We also provide the <code>--table-type</code> arugment to &quot;otu.&quot;  Finally, we specify that we want our OTU table to have the taxonomy assigned to each OTU as the last column in the table (<code>--header-key</code> set to &quot;taxonomy&quot;) and that the name of this column, <code>--output-metadata-id</code>, will be the &quot;ConsensusLineage&quot;</p>

<h2 id="where-to-find-qiime-resources-and-help">Where to find QIIME resources and help</h2>

<ul>
<li> <a href="qiime.org">QIIME</a> offers a suite of developer-designed <a href="http://www.qiime.org/tutorials/tutorial.html">tutorials</a>.</li>
<li> <a href="http://www.qiime.org/scripts/index.html">Documentation</a> for all QIIME scripts.</li>
<li> There is a very active <a href="https://groups.google.com/forum/#!forum/qiime-forum">QIIME Forum</a> on Google Groups.  This is a great place to troubleshoot problems, responses often are returned in a few hours!</li>
<li> The <a href="http://qiime.wordpress.com/">QIIME Blog</a> provides updates like bug fixes, new features, and new releases.</li>
<li> QIIME development is on <a href="https://github.com/biocore/qiime">GitHub</a>.</li>
</ul>

<hr>

<hr>


<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'edamame'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

                    </div>

                
            </div>


            <div class=row-fluid>
                <div id=footer class=span12>
                    Documentation for <a href="http://edamame-course.org">EDAMAME</a>.

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
    </body>
</html>
